patched, so that it can be compiled with g++ 
